- hosts:
  - nfsserver0
  become: yes
  become_method: sudo
  become_user: root
  gather_facts: yes
  connection: lxd

  tasks:

     - name: install nfs-server
       shell: |
               sudo apt-get update && sudo apt-get install -y nfs-server
               sudo mkdir -p /nfs-storage


     - name: Add NFS access rights for k8 cluster nodes 
       lineinfile:
         path: "/etc/exports"
         line: |
               /nfs-storage *(rw,no_subtree_check,no_root_squash)

     - name: enable nfs-server
       shell: |
               sudo systemctl enable --now nfs-server
               sudo exportfs -ar



- hosts:
  - localhost
  tasks:

     - name: change to kustomize file directory for nfs-server
       shell: |
            cd /home/gk/projects/infra-src/kustomize/nfs-provisioner
            kustomize build .  --enable-helm |kubectl apply -f -